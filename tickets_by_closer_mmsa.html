<!-- Monthly Ticket Leaderboard
Sorry my code sucks. Created by Spencer Stewart | spencer@spencer.tech
Limitations: Only includes first 100 tickets (by ID) from the current month.
-->
<script src="js/jquery-3.1.1.min.js" charset="utf-8"></script>
<h1>Monthly Ticket Leaderboard</h1>
<style media="screen">
  .p_box {
    margin: 2px;
    /*border: 2px solid #aaa;*/
    background-color: #eaeaea;
    float: left;
    width: 23%;
    font-family: Arial, sans-serif;
    font-size: 16px;
    font-weight: 800;
    text-align: center;
  }
  .name {
    color: #cf9605;
    padding: 1em;
  }
  .first {
    background-color: #3a66ec;
  }
  .second {
    background-color: #c92a2a;
  }
  .third {
    background-color: #fafafa;
  }
  .fouth {
    background-color: #e8be08;
  }
  .fifth {
    background-color: #129323;
  }
  @media (max-width: 720px) {
    .p_box {
      width: 48%;
    }
  }
  @media (max-width: 400px) {
    .p_box {
      width: 99%;
    }
  }
</style>
<div class="p_box">
  <div class="first name">First: <span id="first_name"></span></div>
  <p id="first_count">Loading...</p>
</div>
<div class="p_box">
  <div class="second name">Second: <span id="second_name"></span></div>
  <p id="second_count">Loading...</p>
</div>
<div class="p_box">
  <div class="third name">Third: <span id="third_name"></span></div>
  <p id="third_count">Loading...</p>
</div>
<div class="p_box">
  <div class="fourth name">Fourth: <span id="fourth_name"></span></div>
  <p id="fourth_count">Loading...</p>
</div>
<div class="p_box">
  <div class="fifth name">Fifth: <span id="fifth_name"></span></div>
  <p id="fifth_count">Loading...</p>
</div>

<div class="p_box" style="background:red;height:200px;width:200px" id="debug">
</div>
<script>
  // Configuration variables
  var updateInterval = 600000; // How frequently to update ticket counts, in milliseconds
  var locationFilter = "(startswith(Site0,'BBMR'))";
  var employees = {
    clindstrom: new Employee([1055, 947]),
    bbrissey: new Employee([1470, 1309]),
    mmossman: new Employee([1405, 1110]),
    rvieau: new Employee([1466, 1280]),
    spencer: new Employee([1493])
  }
  // Create a javascript prototype (model) of employees
  function Employee(ids) {
    this.ids = ids; // Array
    this.count = 0;
  }

  // var clindstrom = new Employee([1055, 947]);
  // var bbrissey = new Employee([1470, 1309]);
  // var mmossman = new Employee([1405, 1110]);
  // var rvieau = new Employee([1466, 1280]);
  // var spencer = new Employee([1493]);


  function updateTicketCount() {
    for (var employee in employees) {
      console.log(employee);
      console.log(employees[employee].ids);

      // personIds = person.ids; // An array of the employee's IDs on Webshare
      // console.log(personIds);

      // for (var i = 0; i < personIds.length; i++) {
      //   console.log(personIds[i]);
      //   $.ajax({
      //     url: "http://webshare/departments/it/_api/Lists/getbytitle('IT%20Helpdesk')/items?$select=*&$filter=(Modified ge datetime'" + startOfMonth + "') and (OData__Status eq 'Closed') and " + locationFilter,
      //     type: "GET",
      //     // dataType: "json",
      //     timeout: 5000,
      //     headers: {
      //         accept: "application/json;odata=verbose",
      //         contentType: "application/json;odata=verbose"
      //     },
      //     success: function (data) {
      //         // you can find the items in JSON format under data.results
      //       var results = data.d.results;
      //     }
      //   });
      // }
    }
  }


    //     var clindstrom = 0;
    //     var bbrissey = 0;
    //     var mmossman = 0;
    //     var rvieau = 0;
    //     var sstewart = 0;
    //     // console.log(results[0].AssignedToId['results']);
    //     for (var i = 0; i < results.length; i++) {
    //       var result = results[i];
    //       for (var j = 0; j < result.AssignedToId.results.length; j++) {
    //         if ((result.AssignedToId.results[j] == 1055) || (result.AssignedToId.results[j] == 947)) {
    //           clindstrom += 1;
    //         } else if ((result.AssignedToId.results[j] == 1470) || (result.AssignedToId.results[j] == 1309)) {
    //           bbrissey += 1;
    //         } else if ((result.AssignedToId.results[j] == 1405) || (result.AssignedToId.results[j] == 1110)) {
    //           mmossman += 1;
    //         } else if ((result.AssignedToId.results[j] == 1466) || (result.AssignedToId.results[j] == 1280)) {
    //           rvieau += 1;
    //         } else if (result.AssignedToId.results[j] == 1493) {
    //           sstewart += 1;
    //         }
    //       }
    //     }
    //     $("#clindstrom").html(clindstrom);
    //     $("#bbrissey").html(bbrissey);
    //     $("#mmossman").html(mmossman);
    //     $("#rvieau").html(rvieau);
    //     $("#sstewart").html(sstewart);
    //   },
    //   error: function (data, errorCode, errorMessage) {
    //       // error handling
    //       $("#clindstrom").html('Error');
    //   }
    // });


  // Get the datetime for the beginning of the month
  function getTheFirst() {
    var d = new Date();
    d.setUTCDate(1);
    d.setUTCHours(0);
    d.setUTCMinutes(0);
    d.setUTCSeconds(0);
    d.setUTCMilliseconds(0);
    return d.toISOString();
  }
  var startOfMonth = getTheFirst();

  // setInterval(updateTicketCount, updateInterval);
  updateTicketCount();
</script>
